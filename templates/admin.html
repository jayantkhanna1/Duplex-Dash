{% load static %}
<!doctype html>
<html lang="en">
<head>
    <!-- Meta -->
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="Duplex Dashs">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- Internal CSS -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700|Varela+Round" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/font-awesome.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/selectize.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="stylesheet" href="{% static 'css/user_profile.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">

    <!-- Title -->
	<title>Duplex Dash - Admin</title>

    <!-- Logo in  -->
    <link rel="icon" type="image/png" href="../static/images/logo.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"/>

    <!-- For jquery and ajax -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->

</head>
<body>
    <header id="header">
        <div id="header_top">
            <div id="header_left">
                <div id="left_signin">
                    <img src="{% static 'images/logo.svg' %}" alt="" id="logo">
                </div>  
            </div>
            <div id="header_right">
                <a href="javascript:void(0)" onclick="make_user_info_visible()">User Info</a>
                <a href="javascript:void(0)" onclick="make_listing_info_visible()">Listings</a>
                <a href="admin_logout">Logout</a>
            </div>
        </div>
    </header>

    <section id="users_payments">
        <div class="card">
            <img src="{% static 'images/user_card_admin.svg' %}" alt="">
            <div class="inner_card">
                <div class="key">Number of Users</div>
                <div class="value">{{user_number}}</div>
            </div>
        </div>
        <div class="card">
            <img src="{% static 'images/money_card_admin.svg' %}" alt="">
            <div class="inner_card">
                <div class="key">Total Revenue</div>
                <div class="value">{{revenue}}</div>
            </div>
        </div>
    </section>

    <section id="user_info_table">
        <h2>User Information</h2>
        <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Username</th>
                <th scope="col">User Email</th>
                <th scope="col">Phone</th>
                <th scope="col">Package</th>
              </tr>
            </thead>
            <tbody>
            {% for user in users %}
              <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td>{{user.username}}</td>
                <td>{{user.email}}</td>
                <td>{{user.phone}}</td>
                <td>{{user.package}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
    </section>  

    <section id="listing_info_table">
        <h2>Listing Information</h2>
        <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Name</th>
                <th scope="col">Seller</th>
                <th scope="col">Price</th>
                <th scope="col">Add 360 link</th>
                <th scope="col">Active</th>
              </tr>
            </thead>
            <tbody>
            {% for listing in listings %}
              <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td>{{listing.name}}</td>
                <td>{{listing.user_name}}</td>
                <td>{{listing.price}}</td>
                <td><a href="javascript:void(0)" onclick="add_360_link_modal('{{listing.id}}')"><i class="fa fa-camera"></i></a></td>
                {% if listing.active == True  %}
                <td>
                    <a href="javascript:void(0)" onclick="make_listing_deactivate('{{listing.id}}')">
                        <input id="checkbox_{{listing.id}}" type="checkbox" checked onclick="make_listing_deactivate('{{listing.id}}')">                 
                    </a>
                </td>
                {% else %}
                <td>
                    <a href="javascript:void(0)" onclick="make_listing_activate('{{listing.id}}')"  >
                        <input id="checkbox_{{listing.id}}" type="checkbox" onclick="make_listing_activate('{{listing.id}}')">               
                    </a>
                </td>
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
    </section>

    <!-- Modal for 360 degree link -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close">&times;</span>
          </div>
          <div class="modal-body">
            <input id="_360_link" type="text" placeholder="Enter link to 360 degree video">
            <a href="javascript:void(0)" onclick="add_360_link()" type="submit" id="submit_button">Add Link</a>
          </div>
        </div>
      
      </div>

    <input type="hidden" value="" id="listing_id">

    <div class="toast" id="toast">
        <div class="toast-body">
        </div>
    </div>
    <input id="hidden_toast" value="off" style="display: none;" readonly type="text">
    <script>
        const toast = document.getElementById('toast');
       
        '{% for message in messages %}'
                 
            if('{{message}}' == 'done'){
                toast.classList.add('visible');
                toast.querySelector('.toast-body').innerHTML = "Payment Successful! Your package is now active!";
                toast.classList.add('toast-body-success');
                document.getElementById("hidden_toast").value = "on"
            }
            if('{{message}}' == 'error'){
                toast.classList.add('visible');
                toast.querySelector('.toast-body').innerHTML = "Payment Failed! Do not worry our technical team is on it.";
                toast.classList.add('toast-body-error');
                document.getElementById("hidden_toast").value = "on"
            }
        '{% endfor %}'
        
        if(document.getElementById("hidden_toast").value == "on"){
            setTimeout(remove_toast,4000)
            
        }
        function remove_toast(){
            const toast = document.getElementById('toast');
            toast.classList.remove('visible');
            document.getElementById("hidden_toast").value = "off"
        }
    </script>
    <script>
        function make_user_info_visible(){
            document.getElementById("user_info_table").style.display = "block";
            document.getElementById("listing_info_table").style.display = "none";
        }
        function make_listing_info_visible(){
            document.getElementById("user_info_table").style.display = "none";
            document.getElementById("listing_info_table").style.display = "block";
        }
    </script>

    <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
          modal.style.display = "none";
        }
        function add_360_link_modal(id){
            document.getElementById("listing_id").value = id;
            document.getElementById("myModal").style.display = "block";
        }
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        }
        </script>
    <script>
        function add_360_link(){
            document.getElementById("myModal").style.display = "none";
            $.ajax({
                    type: 'POST',
                    url : "add_360_link",
                    data : {    
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        'link':document.getElementById("_360_link").value,
                        'listing_id' : document.getElementById("listing_id").value
                    },
                    success: function(response){
                        toast.classList.add('visible');
                        toast.querySelector('.toast-body').innerHTML = "Link Added!";
                        toast.classList.add('toast-body-success');
                        document.getElementById("hidden_toast").value = "on";
                        setTimeout(remove_toast,4000)
                    },
                    error: function(response){
                        toast.classList.add('visible');
                        toast.querySelector('.toast-body').innerHTML = "Error Adding link!";
                        toast.classList.add('toast-body-error');
                        document.getElementById("hidden_toast").value = "on";
                        setTimeout(remove_toast,4000)
                    }
            });
        }
    </script>
    <script>
        function make_listing_activate(listing_id){
            document.getElementById("checkbox_"+listing_id).checked = true;
            $.ajax({
                    type: 'POST',
                    url : "make_listing_active",
                    data : {    
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        'listing_id' : listing_id
                    },
                    success: function(response){
                        document.getElementById("checkbox_"+listing_id).checked = true;
                        toast.classList.add('visible');
                        toast.querySelector('.toast-body').innerHTML = "Listing is now Active!";
                        toast.classList.add('toast-body-success');
                        document.getElementById("hidden_toast").value = "on";
                        setTimeout(remove_toast,4000)
                    },
                    error: function(response){
                        toast.classList.add('visible');
                        toast.querySelector('.toast-body').innerHTML = "Error Making Listing Active!";
                        toast.classList.add('toast-body-error');
                        document.getElementById("hidden_toast").value = "on";
                        setTimeout(remove_toast,4000)
                    }
            });
        }
    </script>
    <script>
        function make_listing_deactivate(listing_id){
            document.getElementById("checkbox_"+listing_id).checked = false;
            $.ajax({
                    type: 'POST',
                    url : "make_listing_deactive",
                    data : {    
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        'listing_id' : listing_id
                    },
                    success: function(response){
                        document.getElementById("checkbox_"+listing_id).checked = false;
                        toast.classList.add('visible');
                        toast.querySelector('.toast-body').innerHTML = "Listing is now Deactivated!";
                        toast.classList.add('toast-body-success');
                        document.getElementById("hidden_toast").value = "on";
                        setTimeout(remove_toast,4000)
                        
                    },
                    error: function(response){
                        toast.classList.add('visible');
                        toast.querySelector('.toast-body').innerHTML = "Error Making Listing Inactive!";
                        toast.classList.add('toast-body-error');
                        document.getElementById("hidden_toast").value = "on";
                        setTimeout(remove_toast,4000)
                    }
            });
        }
    </script>
	<script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/popper.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyBEDfNcQRmKQEyulDN8nGWjLYPm8s4YB58&libraries=places"></script>
	<script src="{% static 'js/selectize.min.js' %}"></script>
	<script src="{% static 'js/masonry.pkgd.min.js' %}"></script>
	<script src="{% static 'js/icheck.min.js' %}"></script>
	<script src="{% static 'js/jquery.validate.min.js' %}"></script>
	<script src="{% static 'js/custom.js' %}"></script>
    <script src="{% static 'js/index.js' %}"></script>
</body>
</html>